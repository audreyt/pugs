#!/usr/bin/perl -w

use strict;
use FindBin;
use File::Spec;
use Config;

my $bin = File::Spec->catfile($FindBin::RealBin, 'pugs_bin') . $Config{_exe};

my $v  = "\014\014\014";   # a string unlikely to be part of a filename
my $vf = qr/(?=$v)/;

local $_ = join($v, "", @ARGV, "");

if (s/${v}-B${v}?JS${vf}//) {
    if (/${v}-e${v}/) {
        $bin = helper_exe('perl5', 'PIL2JS', 'runjs.pl');
    }
    else {
        $bin = helper_exe('perl5', 'PIL2JS', 'jspugs.pl');
    }
}
elsif (s/${v}-B${v}(?i:Perl5)${vf}//) {
    $bin = helper_exe('perl5', 'PIL-Run', 'crude_repl.pl');
}

s/^$v+//;
s/$v+$//;

exec($bin, split($v, $_));
die "$0: exec of $bin failed. $!";

sub helper_exe {
    my $fn = File::Spec->catfile($FindBin::RealBin, @_) . $Config{_exe};
    return $fn if -e $fn;
    return $_[-1] . $Config{_exe};
}
